<div class="experiencia-laboral-form">
  <button *ngIf="!showForm && !isEditMode" class="btn btn-primary" (click)="toggleForm()">
    + Agregar Experiencia Laboral
  </button>

  <div *ngIf="showForm" class="form-container">
    <h4>{{ isEditMode ? 'Editar' : 'Nueva' }} Experiencia Laboral</h4>

    <!-- Error -->
    <div *ngIf="error" class="error-message">
      {{ error }}
    </div>

    <form [formGroup]="experienciaForm" (ngSubmit)="onSubmit()">
      <div class="form-grid">
        <div class="form-group">
          <label for="cargo_ejercido">Cargo Ejercido *</label>
          <input type="text" id="cargo_ejercido" formControlName="cargo_ejercido"
                 [class.error]="f['cargo_ejercido'].invalid && f['cargo_ejercido'].touched">
          <div *ngIf="f['cargo_ejercido'].invalid && f['cargo_ejercido'].touched" class="error-text">
            Cargo ejercido es requerido
          </div>
        </div>

        <div class="form-group">
          <label for="institucion_empresa">Institución/Empresa *</label>
          <input type="text" id="institucion_empresa" formControlName="institucion_empresa"
                 [class.error]="f['institucion_empresa'].invalid && f['institucion_empresa'].touched">
          <div *ngIf="f['institucion_empresa'].invalid && f['institucion_empresa'].touched" class="error-text">
            Institución/empresa es requerida
          </div>
        </div>

        <div class="form-group">
          <label for="fecha_inicio">Fecha de Inicio *</label>
          <input type="date" id="fecha_inicio" formControlName="fecha_inicio"
                 [class.error]="f['fecha_inicio'].invalid && f['fecha_inicio'].touched">
          <div *ngIf="f['fecha_inicio'].invalid && f['fecha_inicio'].touched" class="error-text">
            Fecha de inicio es requerida
          </div>
        </div>

        <div class="form-group">
          <label for="fecha_fin">Fecha de Fin</label>
          <input type="date" id="fecha_fin" formControlName="fecha_fin">
          <small>Dejar vacío si es el trabajo actual</small>
        </div>

        <div class="form-group full-width">
          <label for="descripcion_funciones">Descripción de Funciones</label>
          <textarea id="descripcion_funciones" formControlName="descripcion_funciones" rows="4"
                    placeholder="Describa las funciones y responsabilidades del cargo..."></textarea>
        </div>

        <div class="form-group full-width">
          <label for="documento_file">
            <i class="fa-solid fa-file-upload form-label-icon"></i>
            Documento de Experiencia
          </label>
          
          <!-- Input de archivo -->
          <div class="file-upload-container">
            <input 
              type="file" 
              id="documento_file" 
              class="file-input"
              accept=".pdf,.jpg,.jpeg,.png,.gif,.doc,.docx"
              (change)="onFileSelected($event)"
              [disabled]="uploadingFile || saving">
            
            <label for="documento_file" class="file-upload-label" [class.uploading]="uploadingFile" [class.has-file]="fileName">
              <div class="file-upload-content">
                <i *ngIf="!uploadingFile && !fileName" class="fa-solid fa-cloud-arrow-up file-upload-icon"></i>
                <i *ngIf="uploadingFile" class="fa-solid fa-spinner fa-spin file-upload-icon"></i>
                <i *ngIf="!uploadingFile && fileName" class="fa-solid fa-file-check file-upload-icon"></i>
                <span class="file-upload-text">
                  <span *ngIf="!uploadingFile && !fileName">Seleccionar archivo (PDF, imagen o Word - máx 10MB)</span>
                  <span *ngIf="uploadingFile">Subiendo archivo...</span>
                  <span *ngIf="!uploadingFile && fileName">{{ fileName }}</span>
                </span>
              </div>
            </label>

            <!-- Preview de imagen -->
            <div *ngIf="filePreview && selectedFile && selectedFile.type.startsWith('image/')" class="file-preview">
              <img [src]="filePreview" alt="Preview" class="preview-image">
              <button type="button" class="btn-remove-preview" (click)="removeFile()" title="Eliminar archivo">
                <i class="fa-solid fa-times"></i>
              </button>
            </div>

            <!-- Botón para eliminar archivo si ya está subido -->
            <div *ngIf="fileName && !selectedFile && experienciaForm.get('documento_url')?.value" class="file-info">
              <div class="file-info-content">
                <i class="fa-solid fa-file-pdf"></i>
                <span>{{ fileName }}</span>
                <a [href]="experienciaForm.get('documento_url')?.value" target="_blank" class="btn-view-file" title="Ver documento">
                  <i class="fa-solid fa-external-link"></i>
                </a>
                <button type="button" class="btn-remove-file" (click)="removeFile()" title="Eliminar archivo">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Campo oculto para la URL (solo para el formulario) -->
          <input type="hidden" formControlName="documento_url" id="documento_url_hidden">
          
          <div class="file-help-text">
            <i class="fa-solid fa-info-circle"></i>
            Formatos permitidos: PDF, JPG, PNG, GIF, DOC, DOCX. Tamaño máximo: 10MB
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary" [disabled]="saving">
          {{ saving ? 'Guardando...' : (isEditMode ? 'Actualizar' : 'Guardar') }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="onCancel()" [disabled]="saving">
          Cancelar
        </button>
      </div>
    </form>
  </div>
</div>